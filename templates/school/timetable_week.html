{% extends 'school/base.html' %}
{% load dict_extras %}
{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <a href="{% url 'school:generate_timetable' %}" class="btn btn-success btn-sm">Generate Timetable</a>
    <h4>Weekly Timetable (week of {{ week_days.0|date:"D, M j" }})</h4>
    <form class="d-flex" method="get">
      <input type="date" name="date" value="{{ focus_date }}" class="form-control me-2">
      <button class="btn btn-outline-primary">Go</button>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-top">
      <thead class="table-light text-center">
        <tr>
          <th style="width:140px;">Time</th>
          {% for d in week_days %}
            <th>{{ d|date:"D, M j" }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for slot in time_slots %}
        <tr>
          <td class="fw-bold text-center">{{ slot.start_time|time:"H:i" }} - {{ slot.end_time|time:"H:i" }}</td>
          {% for d in week_days %}
          <td style="min-width:200px; vertical-align: top;">
{% for lesson in table_data|get_item:d|get_item:slot %}
              <div class="card mb-1 p-2 bg-light">
                <strong>{{ lesson.subject.name }}</strong><br>
                <small>{{ lesson.stream.name }}</small><br>
                <small>{{ lesson.teacher.user.get_full_name }}</small><br>
                <small>Room: {{ lesson.room }}</small>
              </div>
            {% empty %}
              <span class="text-muted">No lesson</span>
            {% endfor %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
