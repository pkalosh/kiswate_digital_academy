{% extends 'school/teacher/base.html' %}
{% block title %}Teacher Dashboard | {{ school.name }}{% endblock %}
{% block content %}
<section class="bg-light py-4">
    <div class="container">
        <div class="row g-4">
            <!-- Today's Lessons -->

            <div class="col-6 col-md-3">
            <div class="card k-card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="text-secondary small">Today's Lessons</div>
                    <div class="h4 m-0 fw-bold">{{ today_lessons.count|default:"0" }}</div>
                  </div>
                  <a href="{% url 'school:school-attendance' %}"><span class="k-pill"> <i class="bi bi-eye"></i> Mark Attendance</span></a>
                </div>
              </div>
            </div>
          </div>
            <!-- Assigned Students -->
            <div class="col-6 col-md-3">
            <div class="card k-card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="text-secondary small">Assigned Students</div>
                    <div class="h4 m-0 fw-bold">{{ lessons|length|default:"0" }}</div>
                  </div>
                  <a href="{% url 'school:school-enrollment' %}"><span class="k-pill"> <i class="bi bi-eye"></i> Manage</span></a>
                </div>
              </div>
            </div>
          </div>

            <!-- Upcoming Sessions -->
            <div class="col-6 col-md-3">
            <div class="card k-card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="text-secondary small">Upcoming Sessions</div>
                    <div class="h4 m-0 fw-bold">{{ sessions.count|default:"0" }}</div>
                  </div>
                  <a href="{% url 'school:school-sessions' %}"><span class="k-pill"> <i class="bi bi-eye"></i> View</span></a>
                </div>
              </div>
            </div>
          </div>
            
            <!-- Subjects Taught -->
            <div class="col-6 col-md-3">
            <div class="card k-card">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="text-secondary small">My Subjects</div>
                    <div class="h4 m-0 fw-bold">{{ subjects|length|default:"0" }}</div>
                  </div>
                  <a href="{% url 'school:school-subjects' %}"><span class="k-pill"> <i class="bi bi-eye"></i> Edit</span></a>
                </div>
              </div>
            </div>
          </div>            

           
        </div>
        
        <!-- Lessons by Grade Tabs -->
        {% if lessons_by_grade %}
        <div class="row mt-4">
            <div class="col-12">
                <h5 class="fw-semibold mb-3">Lessons by Grade</h5>
                <ul class="nav nav-tabs mb-3">
                    {% for grade in grades %}
                    <li class="nav-item">
                        <a class="nav-link {% if forloop.first %}active{% endif %}" href="#grade-{{ forloop.counter }}" data-bs-toggle="tab">{{ grade }}</a>
                    </li>
                    {% endfor %}
                </ul>
                <div class="tab-content">
                    {% for grade, grade_lessons in lessons_by_grade.items %}
                    <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="grade-{{ forloop.counter }}">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead><tr><th>Time</th><th>Subject</th><th>Room</th><th>Action</th></tr></thead>
                                <tbody>
                                    {% for lesson in grade_lessons|slice:":5" %}
                                    <tr>
                                        <td>{{ lesson.date|date:"M d" }} {{ lesson.start_time }}</td>
                                        <td>{{ lesson.subject.name }}</td>
                                        <td>{{ lesson.room|default:"N/A" }}</td>
                                        <td><a href="{% url 'school:attendance-mark' lesson.id %}" class="btn btn-sm btn-primary">Mark</a></td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="4">No lessons for this grade.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}