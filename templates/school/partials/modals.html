{% load widget_tweaks %}
{# ----------------------- CREATE STAFF ----------------------- #}
<div class="modal fade" id="createStaffModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="create_staff">

                <div class="modal-header">
                    <h5 class="modal-title">Create Staff</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="row">
                        {% for field in staff_form %}
                            {% if field.field.widget.input_type == "textarea" %}
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                    {% if field.errors %}<div class="text-danger">{{ field.errors }}</div>{% endif %}
                                </div>
                            {% else %}
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                    {% if field.errors %}<div class="text-danger">{{ field.errors }}</div>{% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

{# ----------------------- EDIT STAFF ----------------------- #}
{% for s in other_staff %}
<div class="modal fade" id="editStaffModal{{ s.id }}">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="edit_staff" value="{{ s.id }}">

                <div class="modal-header">
                    <h5 class="modal-title">Edit Staff: {{ s.user.full_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="row">
                        {% for field in staff_form %}
                            {% if field.field.widget.input_type == "textarea" %}
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% else %}
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{# ----------------------- CREATE STUDENT ----------------------- #}
<div class="modal fade" id="createStudentModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="create_student">

                <div class="modal-header">
                    <h5 class="modal-title">Create Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="row">
                        {% for field in student_form %}
                            {% if field.field.widget.input_type == "textarea" %}
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% else %}
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

{# ----------------------- EDIT STUDENT ----------------------- #}
{% for st in students %}
<div class="modal fade" id="editStudentModal{{ st.id }}">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="edit_student" value="{{ st.id }}">

                <div class="modal-header">
                    <h5 class="modal-title">Edit Student: {{ st.user.full_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="row">
                        {% for field in student_form %}
                            {% if field.field.widget.input_type == "textarea" %}
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% else %}
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{# ----------------------- CREATE PARENT + STUDENT ----------------------- #}
<div class="modal fade" id="createParentStudentModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="create_parent_student">

                <div class="modal-header">
                    <h5 class="modal-title">Create Parent + Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <!-- Parent Details -->
                    <h5>Parent Details</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_first_name.label_tag }}
                            {{ parent_student_form.parent_first_name }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_last_name.label_tag }}
                            {{ parent_student_form.parent_last_name }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_email.label_tag }}
                            {{ parent_student_form.parent_email }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_phone_number.label_tag }}
                            {{ parent_student_form.parent_phone_number }}
                        </div>

                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_id.label_tag }}
                            {{ parent_student_form.parent_id }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_dob.label_tag }}
                            {{ parent_student_form.parent_dob }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_gender.label_tag }}
                            {{ parent_student_form.parent_gender }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ parent_student_form.parent_address.label_tag }}
                            {{ parent_student_form.parent_address }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ parent_student_form.parent_bio.label_tag }}
                            {{ parent_student_form.parent_bio }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.parent_profile_picture.label_tag }}
                            {{ parent_student_form.parent_profile_picture }}
                        </div>
                    </div>

                    <!-- Student Details -->
                    <h5 class="mt-4">Student Details</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_first_name.label_tag }}
                            {{ parent_student_form.student_first_name }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_last_name.label_tag }}
                            {{ parent_student_form.student_last_name }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_email.label_tag }}
                            {{ parent_student_form.student_email }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_phone_number.label_tag }}
                            {{ parent_student_form.student_phone_number }}
                        </div>

                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_id.label_tag }}
                            {{ parent_student_form.student_id }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_dob.label_tag }}
                            {{ parent_student_form.student_dob }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.enrollment_date.label_tag }}
                            {{ parent_student_form.enrollment_date }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_gender.label_tag }}
                            {{ parent_student_form.student_gender }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.grade_level.label_tag }}
                            {{ parent_student_form.grade_level }}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ parent_student_form.student_profile_picture.label_tag }}
                            {{ parent_student_form.student_profile_picture }}
                        </div>
                        <div class="col-md-12 mb-3">
                            {{ parent_student_form.student_bio.label_tag }}
                            {{ parent_student_form.student_bio }}
                        </div>
                        <div class="col-md-12 mb-3">
                            {{ parent_student_form.student_parents.label_tag }}
                            {{ parent_student_form.student_parents }}
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple parents.</small>
                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>


{# ----------------------- EDIT PARENT ----------------------- #}
{% for p in parents %}
<div class="modal fade" id="editParentModal{{ p.id }}">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="edit_parent" value="{{ p.id }}">

                <div class="modal-header">
                    <h5 class="modal-title">Edit Parent: {{ p.user.full_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <h5>Parent Details</h5>
                    <div class="row">
                        {% for field in combined_parent_student_form.parent_form %}
                            {% if field.field.widget.input_type == "textarea" %}
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% else %}
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control" }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{# ----------------------- ASSIGN STUDENT MODAL ----------------------- #}
<div class="modal fade" id="assignStudentModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="assign_student">

                <div class="modal-header">
                    <h5 class="modal-title">Assign Student to Parent</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <label class="form-label">Parent</label>
                    <select name="parent_id" class="form-select mb-3">
                        {% for p in parents %}
                        <option value="{{ p.id }}">{{ p.user.full_name }}</option>
                        {% endfor %}
                    </select>

                    <label class="form-label">Student</label>
                    <select name="student_id" class="form-select">
                        {% for st in students %}
                        <option value="{{ st.id }}">{{ st.user.full_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success">Assign</button>
                </div>
            </form>
        </div>
    </div>
</div>
