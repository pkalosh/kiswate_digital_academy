<!-- templates/school/staff.html (complete, mobile-responsive with tabs and tables) -->
{% extends 'school/base.html' %}
{% load static %}
{% load widget_tweaks form_extras %}
{% block title %}School Users | {{ school.name }}{% endblock %}
{% block content %}
<style>
.nav-tabs .nav-link:hover {
    color: black !important;
}
.nav-tabs .nav-link.active {
    background-color: green !important;
    color: black !important;
    border-color: green !important;
}
</style>
<section class="content container-fluid py-4">
<!-- System Messages -->
    {% if messages %}
<div class="row">
        {% for message in messages %}
<div class="col-12">
<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message|safe }}
<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
</div>
        {% endfor %}
</div>
    {% endif %}
<div class="container">
<h2 class="mb-4">School Users Management</h2>
<!-- Global Search -->
<form method="GET" class="mb-4">
<div class="input-group">
<input type="text" name="q" class="form-control" placeholder="Search all users..." value="{{ query }}">
<button class="btn btn-outline-primary" type="submit"><i class="bi bi-search"></i> Search</button>
</div>
</form>
<!-- NAV TABS -->
<ul class="nav nav-tabs mb-4" id="userTabs">
<li class="nav-item">
<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#teachers">Teachers</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#staff">Other Staff</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#students">Students</button>
</li>
<li class="nav-item">
<button class="nav-link" data-bs-toggle="tab" data-bs-target="#parents">Parents</button>
</li>
</ul>
<div class="tab-content">
<!-- ======================= TEACHERS TAB ======================= -->
<div class="tab-pane fade show active" id="teachers">
<div class="d-flex justify-content-end mb-3">
<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createStaffModal">
<i class="bi bi-plus-circle"></i> Create Staff
</button>
</div>
<div class="table-responsive">
<table class="table table-striped">
<thead>
<tr><th>Name</th><th>Subject</th><th>Class</th><th>Stream</th><th>Actions</th></tr>
</thead>
<tbody>
                            {% for t in teachers %}
<tr>
<td>{{ t.user.first_name }} {{ t.user.last_name }}</td>
<td>{% for s in t.user.staffprofile.subjects.all %}{{ s }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
<td>{% for s in t.user.staffprofile.subjects.all %}{{ s.grade }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
<td>{{ t.user.staffprofile.stream }}</td>
<td class="d-flex gap-1">
<button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewStaffModal{{ t.id }}">
<i class="bi bi-eye"></i> View
</button>
<button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editStaffModal{{ t.id }}">
<i class="bi bi-pencil-square"></i> Edit
</button>
<button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteStaffModal{{ t.id }}">
<i class="bi bi-trash"></i> Delete
</button>
</td>
</tr>
                            {% empty %}
<tr><td colspan="5" class="text-center">No teachers found.</td></tr>
                            {% endfor %}
</tbody>
</table>
</div>
                {% include 'school/partials/pagination.html' with page_obj=teachers_page %}
<!-- View and Edit Modals for Teachers -->
    {% for t in teachers %}
<!-- View Teacher Modal -->
<div class="modal fade" id="viewStaffModal{{ t.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">View Teacher: {{ t.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p><strong>Email:</strong> {{ t.user.email }}</p>
<p><strong>Phone:</strong> {{ t.user.phone_number }}</p>
<p><strong>Subjects:</strong> {% for s in t.user.staffprofile.subjects.all %}{{ s }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
<p><strong>Classes:</strong> {% for s in t.user.staffprofile.subjects.all %}{{ s.grade }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
<p><strong>Stream:</strong> {{ t.user.staffprofile.stream|default:"N/A" }}</p>
<p><strong>Bio:</strong> {{ t.user.staffprofile.bio|default:"N/A" }}</p>
                        {% if t.user.staffprofile.profile_picture %}
<img src="{{ t.user.staffprofile.profile_picture.url }}" class="img-thumbnail" alt="Profile" style="max-width: 200px;">
                        {% endif %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!-- Edit Teacher Modal -->
<div class="modal fade" id="editStaffModal{{ t.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Edit Teacher: {{ t.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<form method="POST" action="{% url 'school:update_staff' t.id %}" enctype="multipart/form-data">
                        {% csrf_token %}
<div class="modal-body">
{% with staff_form=staff_update_forms|get_item:t.id %}
<div class="row g-3">
<div class="col-md-6">
<label class="form-label">First Name</label>
<input type="text" name="first_name" value="{{ t.user.first_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Last Name</label>
<input type="text" name="last_name" value="{{ t.user.last_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Email</label>
{{ staff_form.email|add_class:"form-control" }}
{% if staff_form.email.errors %}<div class="text-danger">{{ staff_form.email.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Phone Number</label>
{{ staff_form.phone_number|add_class:"form-control" }}
{% if staff_form.phone_number.errors %}<div class="text-danger">{{ staff_form.phone_number.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Subjects</label>
{{ staff_form.subjects|add_class:"form-control select2" }}
{% if staff_form.subjects.errors %}<div class="text-danger">{{ staff_form.subjects.errors }}</div>{% endif %}
<small class="text-muted">Hold Ctrl/Cmd to select multiple.</small>
</div>
<div class="col-md-6">
<label class="form-label">Stream</label>
{{ staff_form.stream|add_class:"form-control" }}
{% if staff_form.stream.errors %}<div class="text-danger">{{ staff_form.stream.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Bio</label>
{{ staff_form.bio|add_class:"form-control" }}
{% if staff_form.bio.errors %}<div class="text-danger">{{ staff_form.bio.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Profile Picture</label>
{{ staff_form.profile_picture|add_class:"form-control" }}
{% if staff_form.profile_picture.errors %}<div class="text-danger">{{ staff_form.profile_picture.errors }}</div>{% endif %}
</div>
</div>
{% if staff_form.non_field_errors %}
<div class="alert alert-danger">{{ staff_form.non_field_errors }}</div>
{% endif %}
{% if staff_form.errors %}
<div class="alert alert-danger">{{ staff_form.errors }}</div>
{% endif %}
{% endwith %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button type="submit" class="btn btn-warning">Update Teacher</button>
</div>
</form>
</div>
</div>
</div>
    {% endfor %}
</div>
<!-- ======================= OTHER STAFF TAB ======================= -->
<div class="tab-pane fade" id="staff">
<div class="d-flex justify-content-end mb-3">
<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createStaffModal">
<i class="bi bi-plus-circle"></i> Create Staff
</button>
</div>
<div class="table-responsive">
<table class="table table-striped">
<thead><tr><th>Name</th><th>Role</th><th>Actions</th></tr></thead>
<tbody>
                            {% for s in other_staff %}
<tr>
<td>{{ s.user.first_name }} {{ s.user.last_name }}</td>
<td>{{ s.position }}</td>
<td class="d-flex gap-1">
<button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewStaffModal{{ s.id }}">
<i class="bi bi-eye"></i> View
</button>
<button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editStaffModal{{ s.id }}">
<i class="bi bi-pencil-square"></i> Edit
</button>
<button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteStaffModal{{ s.id }}">
<i class="bi bi-trash"></i> Delete
</button>
</td>
</tr>
                            {% empty %}
<tr><td colspan="3" class="text-center">No other staff found.</td></tr>
                            {% endfor %}
</tbody>
</table>
</div>
                {% include 'school/partials/pagination.html' with page_obj=staff_page %}
<!-- View and Edit Modals for Other Staff -->
    {% for s in other_staff %}
<!-- View Staff Modal -->
<div class="modal fade" id="viewStaffModal{{ s.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">View Staff: {{ s.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p><strong>Email:</strong> {{ s.user.email }}</p>
<p><strong>Phone:</strong> {{ s.user.phone_number }}</p>
<p><strong>Position:</strong> {{ s.position }}</p>
<p><strong>Bio:</strong> {{ s.bio|default:"N/A" }}</p>
                        {% if s.profile_picture %}
<img src="{{ s.profile_picture.url }}" class="img-thumbnail" alt="Profile" style="max-width: 200px;">
                        {% endif %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!-- Edit Staff Modal -->
<div class="modal fade" id="editStaffModal{{ s.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Edit Staff: {{ s.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<form method="POST" action="{% url 'school:update_staff' s.id %}" enctype="multipart/form-data">
                        {% csrf_token %}
<div class="modal-body">
{% with staff_form=staff_update_forms|get_item:s.id %}
<div class="row g-3">
<div class="col-md-6">
<label class="form-label">First Name</label>
<input type="text" name="first_name" value="{{ s.user.first_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Last Name</label>
<input type="text" name="last_name" value="{{ s.user.last_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Email</label>
{{ staff_form.email|add_class:"form-control" }}
{% if staff_form.email.errors %}<div class="text-danger">{{ staff_form.email.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Phone Number</label>
{{ staff_form.phone_number|add_class:"form-control" }}
{% if staff_form.phone_number.errors %}<div class="text-danger">{{ staff_form.phone_number.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Position</label>
{{ staff_form.position|add_class:"form-control" }}
{% if staff_form.position.errors %}<div class="text-danger">{{ staff_form.position.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Bio</label>
{{ staff_form.bio|add_class:"form-control" }}
{% if staff_form.bio.errors %}<div class="text-danger">{{ staff_form.bio.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Profile Picture</label>
{{ staff_form.profile_picture|add_class:"form-control" }}
{% if staff_form.profile_picture.errors %}<div class="text-danger">{{ staff_form.profile_picture.errors }}</div>{% endif %}
</div>
</div>
{% if staff_form.non_field_errors %}
<div class="alert alert-danger">{{ staff_form.non_field_errors }}</div>
{% endif %}
{% if staff_form.errors %}
<div class="alert alert-danger">{{ staff_form.errors }}</div>
{% endif %}
{% endwith %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button type="submit" class="btn btn-warning">Update Staff</button>
</div>
</form>
</div>
</div>
</div>
    {% endfor %}
</div>
<!-- ======================= STUDENTS TAB ======================= -->
<div class="tab-pane fade" id="students">
<div class="d-flex justify-content-end mb-3">
<button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createStudentModal">
<i class="bi bi-plus-circle"></i> Create Student
</button>
</div>
<div class="table-responsive">
<table class="table table-striped">
<thead>
<tr><th>Name</th><th>Class</th><th>Actions</th></tr>
</thead>
<tbody>
                            {% for st in students %}
<tr>
<td>{{ st.user.first_name }} {{ st.user.last_name }}</td>
<td>{{ st.grade_level|default:"N/A" }}</td>
<td class="d-flex gap-1">
<button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewStudentModal{{ st.id }}">
<i class="bi bi-eye"></i> View
</button>
<button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editStudentModal{{ st.id }}">
<i class="bi bi-pencil-square"></i> Edit
</button>
<button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteStudentModal{{ st.id }}">
<i class="bi bi-trash"></i> Delete
</button>
</td>
</tr>
                            {% empty %}
<tr><td colspan="3" class="text-center">No students found.</td></tr>
                            {% endfor %}
</tbody>
</table>
</div>
                {% include 'school/partials/pagination.html' with page_obj=students_page %}
<!-- View and Edit Modals for Students -->
    {% for st in students %}
<!-- View Student Modal -->
<div class="modal fade" id="viewStudentModal{{ st.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">View Student: {{ st.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p><strong>ID:</strong> {{ st.student_id }}</p>
<p><strong>Grade:</strong> {{ st.grade_level.name|default:"N/A" }}</p>
<p><strong>DOB:</strong> {{ st.date_of_birth|date:"Y-m-d"|default:"N/A" }}</p>
<p><strong>Email:</strong> {{ st.user.email|default:"N/A" }}</p>
<p><strong>Phone:</strong> {{ st.user.phone_number|default:"N/A" }}</p>
<p><strong>Bio:</strong> {{ st.bio|default:"N/A" }}</p>
                        {% if st.profile_picture %}
<img src="{{ st.profile_picture.url }}" class="img-thumbnail" alt="Profile" style="max-width: 200px;">
                        {% endif %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!-- Edit Student Modal -->
<div class="modal fade" id="editStudentModal{{ st.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Edit Student: {{ st.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<form method="POST" action="{% url 'school:update_student' st.id %}" enctype="multipart/form-data">
                        {% csrf_token %}
<div class="modal-body">
{% with student_form=student_update_forms|get_item:st.id %}
<div class="row g-3">
<div class="col-md-6">
<label class="form-label">First Name</label>
<input type="text" name="first_name" value="{{ st.user.first_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Last Name</label>
<input type="text" name="last_name" value="{{ st.user.last_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Email</label>
{{ student_form.email|add_class:"form-control" }}
{% if student_form.email.errors %}<div class="text-danger">{{ student_form.email.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Phone Number</label>
{{ student_form.phone_number|add_class:"form-control" }}
{% if student_form.phone_number.errors %}<div class="text-danger">{{ student_form.phone_number.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Date of Birth</label>
{{ student_form.date_of_birth|add_class:"form-control" }}
{% if student_form.date_of_birth.errors %}<div class="text-danger">{{ student_form.date_of_birth.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Gender</label>
{{ student_form.gender|add_class:"form-control" }}
{% if student_form.gender.errors %}<div class="text-danger">{{ student_form.gender.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Enrollment Date</label>
{{ student_form.enrollment_date|add_class:"form-control" }}
{% if student_form.enrollment_date.errors %}<div class="text-danger">{{ student_form.enrollment_date.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Grade Level</label>
{{ student_form.grade_level|add_class:"form-control select2" }}
{% if student_form.grade_level.errors %}<div class="text-danger">{{ student_form.grade_level.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Bio</label>
{{ student_form.bio|add_class:"form-control" }}
{% if student_form.bio.errors %}<div class="text-danger">{{ student_form.bio.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Parents</label>
{{ student_form.parents|add_class:"form-control select2" }}
{% if student_form.parents.errors %}<div class="text-danger">{{ student_form.parents.errors }}</div>{% endif %}
<small class="text-muted">Hold Ctrl/Cmd to select multiple.</small>
</div>
<div class="col-12">
<label class="form-label">Profile Picture</label>
{{ student_form.profile_picture|add_class:"form-control" }}
{% if student_form.profile_picture.errors %}<div class="text-danger">{{ student_form.profile_picture.errors }}</div>{% endif %}
</div>
</div>
{% if student_form.non_field_errors %}
<div class="alert alert-danger">{{ student_form.non_field_errors }}</div>
{% endif %}
{% if student_form.errors %}
<div class="alert alert-danger">{{ student_form.errors }}</div>
{% endif %}
{% endwith %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button type="submit" class="btn btn-warning">Update Student</button>
</div>
</form>
</div>
</div>
</div>
    {% endfor %}
</div>
<!-- ======================= PARENTS TAB ======================= -->
<div class="tab-pane fade" id="parents">
<div class="d-flex justify-content-end mb-3 gap-2 flex-wrap">
<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createParentModal">
<i class="bi bi-plus-circle"></i> Create Parent
</button>
<button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createParentStudentModal">
<i class="bi bi-people"></i> Create Parent + Student
</button>
<button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#assignStudentModal">
<i class="bi bi-person-plus"></i> Assign Student
</button>
</div>
<div class="table-responsive">
<table class="table table-striped">
<thead>
<tr><th>Parent Name</th><th>Phone</th><th>Students</th><th>Actions</th></tr>
</thead>
<tbody>
                            {% for p in parents %}
<tr>
<td>{{ p.user.first_name }} {{ p.user.last_name }}</td>
<td>{{ p.phone|default:"N/A" }}</td>
<td>
                                    {% for child in p.student_set.all %}
<span class="badge bg-primary me-1 mb-1">{{ child.user.get_full_name }}</span>
                                    {% empty %}
<span class="text-muted">No students</span>
                                    {% endfor %}
</td>
<td class="d-flex gap-1">
<button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewParentModal{{ p.id }}">
<i class="bi bi-eye"></i> View
</button>
<button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editParentModal{{ p.id }}">
<i class="bi bi-pencil-square"></i> Edit
</button>
<button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteParentModal{{ p.id }}">
<i class="bi bi-trash"></i> Delete
</button>
</td>
</tr>
                            {% empty %}
<tr><td colspan="4" class="text-center">No parents found.</td></tr>
                            {% endfor %}
</tbody>
</table>
</div>
                {% include 'school/partials/pagination.html' with page_obj=parents_page %}
<!-- View and Edit Modals for Parents -->
    {% for p in parents %}
<!-- View Parent Modal -->
<div class="modal fade" id="viewParentModal{{ p.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">View Parent: {{ p.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p><strong>ID:</strong> {{ p.parent_id|default:"N/A" }}</p>
<p><strong>DOB:</strong> {{ p.date_of_birth|date:"Y-m-d"|default:"N/A" }}</p>
<p><strong>Gender:</strong> {{ p.gender|default:"N/A" }}</p>
<p><strong>Email:</strong> {{ p.user.email|default:"N/A" }}</p>
<p><strong>Phone:</strong> {{ p.phone_number|default:"N/A" }}</p>
<p><strong>Address:</strong> {{ p.address|default:"N/A" }}</p>
<p><strong>Bio:</strong> {{ p.bio|default:"N/A" }}</p>
<p><strong>Students:</strong>
    {% for child in p.student_set.all %}
    <span class="badge bg-primary me-1">{{ child.user.get_full_name }}</span>
    {% empty %}
    <span class="text-muted">No students assigned</span>
    {% endfor %}
</p>
                        {% if p.profile_picture %}
<img src="{{ p.profile_picture.url }}" class="img-thumbnail" alt="Profile" style="max-width: 200px;">
                        {% endif %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<!-- Edit Parent Modal -->
<div class="modal fade" id="editParentModal{{ p.id }}" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Edit Parent: {{ p.user.get_full_name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<form method="POST" action="{% url 'school:update_parent' p.id %}" enctype="multipart/form-data">
                        {% csrf_token %}
<div class="modal-body">
{% with parent_form=parent_update_forms|get_item:p.id %}
<div class="row g-3">
<div class="col-md-6">
<label class="form-label">First Name</label>
<input type="text" name="first_name" value="{{ p.user.first_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Last Name</label>
<input type="text" name="last_name" value="{{ p.user.last_name }}" class="form-control" required>
</div>
<div class="col-md-6">
<label class="form-label">Email</label>
{{ parent_form.email|add_class:"form-control" }}
{% if parent_form.email.errors %}<div class="text-danger">{{ parent_form.email.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Phone Number</label>
{{ parent_form.phone_number|add_class:"form-control" }}
{% if parent_form.phone_number.errors %}<div class="text-danger">{{ parent_form.phone_number.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Parent ID</label>
{{ parent_form.parent_id|add_class:"form-control" }}
{% if parent_form.parent_id.errors %}<div class="text-danger">{{ parent_form.parent_id.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Date of Birth</label>
{{ parent_form.date_of_birth|add_class:"form-control" }}
{% if parent_form.date_of_birth.errors %}<div class="text-danger">{{ parent_form.date_of_birth.errors }}</div>{% endif %}
</div>
<div class="col-md-6">
<label class="form-label">Gender</label>
{{ parent_form.gender|add_class:"form-control" }}
{% if parent_form.gender.errors %}<div class="text-danger">{{ parent_form.gender.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Address</label>
{{ parent_form.address|add_class:"form-control" }}
{% if parent_form.address.errors %}<div class="text-danger">{{ parent_form.address.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Bio</label>
{{ parent_form.bio|add_class:"form-control" }}
{% if parent_form.bio.errors %}<div class="text-danger">{{ parent_form.bio.errors }}</div>{% endif %}
</div>
<div class="col-12">
<label class="form-label">Students</label>
{{ parent_form.students|add_class:"form-control select2" }}
{% if parent_form.students.errors %}<div class="text-danger">{{ parent_form.students.errors }}</div>{% endif %}
<small class="text-muted">Hold Ctrl/Cmd to select multiple.</small>
</div>
<div class="col-12">
<label class="form-label">Profile Picture</label>
{{ parent_form.profile_picture|add_class:"form-control" }}
{% if parent_form.profile_picture.errors %}<div class="text-danger">{{ parent_form.profile_picture.errors }}</div>{% endif %}
</div>
</div>
{% if parent_form.non_field_errors %}
<div class="alert alert-danger">{{ parent_form.non_field_errors }}</div>
{% endif %}
{% if parent_form.errors %}
<div class="alert alert-danger">{{ parent_form.errors }}</div>
{% endif %}
{% endwith %}
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button type="submit" class="btn btn-warning">Update Parent</button>
</div>
</form>
</div>
</div>
</div>
    {% endfor %}
</div>
</div>
</div>
<!-- ======================= ALL MODALS ======================= -->
    {% include 'school/partials/modals.html' %}
<!-- ======================= DELETE MODALS ======================= -->
    {% for t in teachers %}
<div class="modal fade" id="deleteStaffModal{{ t.id }}">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Confirm Delete</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">Delete teacher <strong>{{ t.user.get_full_name }}</strong>?</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<a href="{% url 'school:delete_staff' t.id %}" class="btn btn-danger">Delete</a>
</div>
</div>
</div>
</div>
    {% endfor %}
    {% for s in other_staff %}
<div class="modal fade" id="deleteStaffModal{{ s.id }}">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Confirm Delete</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">Delete staff <strong>{{ s.user.get_full_name }}</strong>?</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<a href="{% url 'school:delete_staff' s.id %}" class="btn btn-danger">Delete</a>
</div>
</div>
</div>
</div>
    {% endfor %}
    {% for st in students %}
<div class="modal fade" id="deleteStudentModal{{ st.id }}">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Confirm Delete</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">Delete student <strong>{{ st.user.get_full_name }}</strong>?</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<a href="{% url 'school:delete_student' st.id %}" class="btn btn-danger">Delete</a>
</div>
</div>
</div>
</div>
    {% endfor %}
    {% for p in parents %}
<div class="modal fade" id="deleteParentModal{{ p.id }}">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Confirm Delete</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">Delete parent <strong>{{ p.user.get_full_name }}</strong>?</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<a href="{% url 'school:delete_parent' p.id %}" class="btn btn-danger">Delete</a>
</div>
</div>
</div>
</div>
    {% endfor %}
</section>
<!-- Select2 CSS/JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    $('.select2').select2({
        theme: 'bootstrap-5',
        width: '100%',
        placeholder: "Select options..."  // Helps if empty queryset
    });
});
</script>
{% endblock %}