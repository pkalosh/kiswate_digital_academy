{% extends 'school/base.html' %}
{% block title %}Dashboard | {{ school.name }}{% endblock %}


{% block content %}

<!-- Summary Cards -->
<div class="row g-2" data-aos="fade-up">
  <div class="col-6 col-md-4">
    <div class="card k-card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-secondary small">Total Teachers</div>
            <div class="h4 m-0 fw-bold">{{ total_teachers|default:"0" }}</div>
          </div>
          <a href=""><span class="k-pill"> <i class="bi bi-eye"></i> View</span></a>
        </div>
        <div class="k-progress mt-2"><span style="width:75%"></span></div>
      </div>
    </div>
  </div>

  <div class="col-6 col-md-4">
    <div class="card k-card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-secondary small">Total Students</div>
            <div class="h4 m-0 fw-bold">{{ total_students|default:"0" }}</div>
          </div>
          <a href=""><span class="k-pill"> <i class="bi bi-eye"></i> View</span></a>
        </div>
        <div class="k-progress mt-2"><span style="width:55%"></span></div>
      </div>
    </div>
  </div>

  <div class="col-6 col-md-4">
    <div class="card k-card">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="text-secondary small">Discipline Cases</div>
            <div class="h4 m-0 fw-bold">{{ total_discipline_cases|default:"0" }}</div>
          </div>
          <a href="{% url 'school:school-discipline' %}"><span class="k-pill"> <i class="bi bi-eye"></i> View</span></a>
        </div>
        <div class="k-progress mt-2"><span style="width:60%"></span></div>
      </div>
    </div>
  </div>


</div>


<section class="py-5" data-aos="fade-up" data-aos-delay="50">
  <div class="container">
    <h2 class="fw-bold mb-4 text-center">School Timetable</h2>

    {% if timetables_with_lessons %}
    <div class="accordion" id="timetableAccordion">
      {% for item in timetables_with_lessons %}
        {% with tt=item.timetable lessons=item.lessons %}
        <div class="accordion-item mb-2">
          <h2 class="accordion-header" id="heading{{ tt.id }}">
            <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse{{ tt.id }}"
                    aria-expanded="false"
                    aria-controls="collapse{{ tt.id }}">
              {{ tt.grade.name }} - Term {{ tt.term }} {{ tt.year }}
              {% if item.active %}<span class="badge bg-success ms-2">Active</span>{% endif %}
              <small class="text-muted ms-2">({{ item.lessons_count }} lessons)</small>
            </button>
          </h2>
          <div id="collapse{{ tt.id }}" class="accordion-collapse collapse"
               aria-labelledby="heading{{ tt.id }}"
               data-bs-parent="#timetableAccordion">
            <div class="accordion-body p-0">
              {% if lessons %}
              <table class="table table-hover m-0">
                <thead class="table-light">
                  <tr>
                    <th>Date</th>
                    <th>Day</th>
                    <th>Subject</th>
                    <th>Teacher</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Room</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  {% for lesson in lessons %}
                  <tr>
                    <td>{{ lesson.day_of_week }}</td>
                    <td>{{ lesson.lesson_date|date:"M d Y" }}</td>
                    <td>{{ lesson.subject.name }}</td>
                    <td>{{ lesson.teacher.user.get_full_name }}</td>
                    <td>{{ lesson.time_slot.start_time }}</td>
                    <td>{{ lesson.time_slot.end_time}}</td>
                    <td>{{ lesson.room|default:"-" }}</td>
                    <td>{{ lesson.notes|default:"-" }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
              {% else %}
              <p class="text-center text-muted m-3">No lessons available for this timetable.</p>
              {% endif %}
            </div>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>
    {% else %}
      <p class="text-center text-muted">No timetables available.</p>
    {% endif %}

  </div>
</section>






{% endblock %}